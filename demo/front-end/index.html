<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>My Weekend Panorama Temuco</title>
    <link rel="stylesheet" href="css/estiloindex.css" />
        <script src="javaScript/javaslogin.js"></script>
    
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi"
      crossorigin="anonymous"/>

  </head>

  <body>
      <div class="sesion" id="sesion">
          <button type="button" title="Cerrar Sesión" onclick="logoutUser()" name="Sesion">
           Cerrar Sesión</button>   
      </div>

      <div class="banner">
        <img class="banner" src="img/banner.jpg">
      </div>

    <div class="container-fluid">     
      <div class="row">
        <div class="col-lg-5">
          <h3 class="question">¿Con cuánto dinero cuentas?</h3>
        </div>
        <div class="col-lg-3">
          <div  class="input-group mb-3">
            <span class="input-group-text">$</span>
            <input type="text" id="filter"  class="form-control" aria-label="Peso Chileno"/>
          </div>
        </div>
        <div class="col-lg-4">
          <div id="panorama">
            <button type="button" id="filterb" onclick="filterByPrice()" title="Ver Panorama" name="Panorama">
              Ver mi Panorama
            </button>
          </div>
        </div>
      </div>
    </div>

    <div id="cantdatos" class="cantdatos" >      
    </div>    
    <div id="result" class="container; col-lg-3">   


     <script>
      var current_page = 1;
      var records_per_page = 2;
     
      let cont=1;

      function mostrartodo(){
      objJson = [];
      let result=document.getElementById("result");
      fetch('http://localhost:8080/filtrarlugar')
      .then(response => response.json())
      .then(json => {
      console.log(json);
       
      cantdatos.innerHTML="<span class='border border-3'> Lugares encontrados : " + json.length; +"</span>"
        
       for(data of json){
          console.log(data)
          let nombrelugar=data.nombre_l; 
          let locationplace=data.ubicacion;
          let descripcionlugar=data.descripcion;
          let preciolugar=data.precio;
          let imglugar=data.img;

          let tarjeta="<div class='card'><div class='cardheader'><b>$"+data.precio+"</b></div><img src='"+data.img+"'class='cardimg'alt='...'><div class='card-body'><h5 class='card-title'>"+data.nombre_l+"</h5><p class='cardtext'> "+data.descripcion+"</p><a href='"+data.ubicacion+"' style='background-color:#0C8218; width:100%' class='btn btn-success'><b>VER MAPA</b></a></div></div>"

          
//llena el objeto "objJson" con los parametros obtenido de la base de datos guardados en la variable tarjeta.
          objJson.push({ adName: tarjeta})
          //al inicio muestra los datos de la primera pagina
          if (cont<=records_per_page){
            let htmlContent=result.innerHTML        
            result.innerHTML=htmlContent+tarjeta
            btn_prev.style.visibility = "hidden";
          }
          cont++


          
          
          /*let htmlcontent=result.innerHTML;
          result.innerHTML=htmlcontent+html*/
        }

      })}
      function prevPage()
{
    if (current_page > 1) {
        current_page--;
        changePage(current_page);
    }
}

      function nextPage()
{
    if (current_page < numPages()) {
        current_page++;
        changePage(current_page);
    }
}

function changePage(page)
{
    var btn_next = document.getElementById("btn_next");
    var btn_prev = document.getElementById("btn_prev");
    var listing_table = document.getElementById("listingTable");
    var page_span = document.getElementById("page");
 
    // Validate page
    if (page < 1) page = 1;
    if (page > numPages()) page = numPages();

    result.innerHTML = "";

    for (var i = (page-1) * records_per_page; i < (page * records_per_page) && i < objJson.length; i++) {
        result.innerHTML += objJson[i].adName + "<br>";
    }
    page_span.innerHTML = page + "/" + numPages();

    if (page == 1) {
        btn_prev.style.visibility = "hidden";
    } else {
        btn_prev.style.visibility = "visible";
    }

    if (page == numPages()) {
        btn_next.style.visibility = "hidden";
    } else {
        btn_next.style.visibility = "visible";
    }
}

function numPages()
{
    return Math.ceil(objJson.length / records_per_page);
}

window.onload = function() {
    changePage(1);
};




      function filterByPrice(){
      objJson = [];
      let resultf=document.getElementById("filter").value;
      //console.log("aca"+ resultf) 
      cont=1;
      let url="'http://localhost:8080/filtrarlugar/ "
      let resulturl=url+resultf+"'"
      console.log(resulturl)
      fetch('http://localhost:8080/filtrarlugar/'+resultf )
      .then(response => response.json())
      .then(json => {

        console.log("acá va el dato"+json);
        cantdatos.innerHTML=""
        cantdatos.innerHTML="Lugares encontrados : " + json.length;
        result.innerHTML=""
        for(data of json){
         console.log(data)
      
          let nombrelugar=data.nombre_l; 
          let locationplace=data.ubicacion;
          let descripcionlugar=data.descripcion;
          let preciolugar=data.precio;
          let imglugar=data.img;

          let tarjeta="<div class='card'><div class='cardheader'><b>$"+data.precio+"</b></div><img src='"+data.img+"'class='cardimg'alt='...'><div class='card-body'><h5 class='card-title'>"+data.nombre_l+"</h5><p class='cardtext'> "+data.descripcion+"</p><a href='"+data.ubicacion+"' style='background-color:#0C8218; width:100%' class='btn btn-success'><b>VER MAPA</b></a></div></div>"

          
          
          //console.log(preciolugar);  
          objJson.push({ adName: tarjeta})
          //al inicio muestra los datos de la primera pagina
          if (cont<=records_per_page){
            let htmlContent=result.innerHTML        
            result.innerHTML=htmlContent+tarjeta
            btn_prev.style.visibility = "hidden";
          }
          cont++
         // insertAdjacentHTML().result=htmlContent+tarjeta

          
          /*let htmlcontent=result.innerHTML;
          result.innerHTML=htmlcontent+html*/
        }

      })}
      
     </script>

    
    
    </div>
  

    <script>
    verifyIsLogin();
    mostrartodo();
    </script>

    </div class="container-fluid">
    <div id="listingTable"></div>
    
    <a href="javascript:prevPage()" id="btn_prev">Prev</a>
    <a href="javascript:nextPage()" id="btn_next">Next</a>
    page: <span id="page"></span>

  </body>
</html>
      