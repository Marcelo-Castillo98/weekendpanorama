<!doctype html>

<html lang="es">

<head>

    <meta charset="utf-8">

    <title> My Weekend Panorama Web - Temuco </title>
    <link href="https://fonts.googleapis.com/css?family=Nunito&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Overpass&display=swap" rel="stylesheet">
    <!-- Link hacia el archivo de estilos css -->
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <link rel="stylesheet" href="css/estilos.css">

</head>

<body>

    <div id="contenedor">
        <div id="central">
            <div id="login">
                <div class="titulo">
                    Registrarse
                </div>
                <form id="loginform">
                    <label for="usuario">Nombre de usuario: </label>
                    <input type="text" name="nombre_usuario" id="nombre_usuario" required>

                    <label for="password">Contrase√±a: </label>
                    <input type="password" name="clave" id="clave" required>

                    <label for="nombre">Nombre: </label>
                    <input type="text" name="nombre" id="nombre" required>

                    <label for="apellido">Apellido: </label required>
                    <input type="text" name="apellido" id="apellido">

                    <button type="button" onclick="envioDato()">Guardar</button>
                </form>
                <script>
                    function validar() {
                        let num = 0;
                        if (document.getElementById("nombre_usuario").value == "") {
                            num++

                        }
                        if (document.getElementById("clave").value == "") {
                            num++
                        }
                        if (document.getElementById("nombre").value == "") {
                            num++
                        }
                        if (document.getElementById("apellido").value == "") {
                            num++
                        }
                        return num;
                    }

                    function envioDato() {
                        if (validar() > 0) {
                            swal("ha ocurrido un error", "todos los campos son obligatorios", "error");
                        }
                        else {

                            let nombre_usuariov = document.getElementById('nombre_usuario').value;

                            let clavev = document.getElementById('clave').value;
                            let nombrev = document.getElementById('nombre').value;
                            let apellidov = document.getElementById('apellido').value;


                            let data = {
                                nombre_usuario: nombre_usuariov,
                                clave: clavev,
                                nombre: nombrev,
                                apellido: apellidov
                            };

                            let usuariorepetido;
                            fetch('http://localhost:8080/usuario', {
                                method: 'POST', 
                                body: JSON.stringify(data), 
                                headers: {
                                    'Content-Type': 'application/json'
                                }

                            })
                                .then(response => response.json())
                                .then(json => {
                                    let respuesta = [];
                                    Object.entries(json).forEach(([key, value]) => {

                                        respuesta.push(value)
                                    })
                                    if (respuesta[0] == 500) {
                                        swal("ha ocurrido un error", respuesta[1], "error");
                                    }
                                    else {
                                        swal("Usuario creado correctamente", respuesta[1], "success")
                                            .then((value) => {
                                                location.href = "Login.html"
                                            });
                                    }



                                });

                        }


                    }

                </script>


            </div>

        </div>
    </div>

</body>

</html>