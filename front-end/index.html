<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>My Weekend Panorama Temuco</title>
    <link rel="stylesheet" href="css/estiloindex.css" />
    <!-- CSS only -->
    <script src="javaScript/javaslogin.js"></script>
    
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi"
      crossorigin="anonymous"
    />

  </head>

  <body>
    <div id="sesion" style="background-color:#ffffff; height:60px;">
      <button type="button" style="font-size:19px; position:absolute; top:2px; right:2px;" title="Cerrar Sesión" onclick="logoutUser()" name="Sesion">
        Cerrar Sesión
      </button>
      
    </div>
        <div style="width:100%;">

          <img style="width:100%;" src="img/banner.jpg">
          


        </div>

    <div class="container-fluid">

      <div class="row">
        <div class="col-lg-10 col">
          <!--TITULO-->
          
        </div>
        <div class="col-lg-2 col">
          <!--BOTON-->
          
        </div>
      </div>
      <div class="row" style="margin-left:43px; margin-top:30px; justify-content:center;">
        <div class="col-lg-4" >
          <h3 class="titulo">¿Con cuánto dinero cuentas?</h3>
        </div>
        <div class="col-lg-4">
          <div  class="input-group mb-3">
            <span class="input-group-text">$</span>
            <input id="filter"
              type="text"
              class="form-control"
              aria-label="Amount (to the nearest dollar)"
            />
          </div>
        </div>
        <div class="col-lg-4">
          <div id="panorama">
            <button type="button" id="filterb" onclick="filterByPrice()" title="Ver Panorama" name="Panorama">
              Ver mi Panorama
            </button>
          </div>
        </div>
      </div>

      <div id="cantdatos" style="font-size:14px; color:rgb(119, 119, 119); margin-left:120px; margin-top: 30px">      
        
      </div>


    </div>
    
    <div id="result" class="container; col-lg-3"  style="display:flex; gap:15px; justify-content:center;
    flex-wrap: wrap;padding-left: 0;margin-top:30px; height: 30%; width: 100%">   
     <script>

    var current_page = 1;
    var records_per_page = 2;
    objJson = [];
    let cont=1;

      function mostrartodo(){
      let result=document.getElementById("result");
      fetch('http://localhost:8080/filtrarlugar')
      .then(response => response.json())
      .then(json => {
        console.log(json);
       


        
        cantdatos.innerHTML="<span class='border border-3'> Lugares encontrados : " + json.length; +"</span>"
        


        for(data of json){
         console.log(data)
          let nombrelugar=data.nombre_l; 
          let locationplace=data.ubicacion;
          let descripcionlugar=data.descripcion;
          let preciolugar=data.precio;
          let imglugar=data.img;

          let tarjeta="<div class='card'style='flex: 0 0 25%;text-align: center; height: 650px;'><div style='color:#65A4BE; background-color:white; font-size: 22px;' class='card-header'><b>$"+data.precio+"</b></div><img src='"+data.img+"' style=' max-height:290px; min-height:200px; height:30%;' class=card-img-top' alt='...'><div class='card-body'><h5 class='card-title'>"+data.nombre_l+"</h5><p class='card-text' style='text-align:justify;height: 65%;';> "+data.descripcion+"</p><a href='"+data.ubicacion+"' style='background-color:#0C8218; width:100%' class='btn btn-success'><b>VER MAPA</b></a></div></div>"

          
//llena el objeto "objJson" con los parametros obtenido de la base de datos guardados en la variable tarjeta.
          objJson.push({ adName: tarjeta})
          //al inicio muestra los datos de la primera pagina
          if (cont<=records_per_page){
            let htmlContent=result.innerHTML        
            result.innerHTML=htmlContent+tarjeta
            btn_prev.style.visibility = "hidden";
          }
          cont++


          
          
          /*let htmlcontent=result.innerHTML;
          result.innerHTML=htmlcontent+html*/
        }

      })}
      function prevPage()
{
    if (current_page > 1) {
        current_page--;
        changePage(current_page);
    }
}

      function nextPage()
{
    if (current_page < numPages()) {
        current_page++;
        changePage(current_page);
    }
}

function changePage(page)
{
    var btn_next = document.getElementById("btn_next");
    var btn_prev = document.getElementById("btn_prev");
    var listing_table = document.getElementById("listingTable");
    var page_span = document.getElementById("page");
 
    // Validate page
    if (page < 1) page = 1;
    if (page > numPages()) page = numPages();

    result.innerHTML = "";

    for (var i = (page-1) * records_per_page; i < (page * records_per_page) && i < objJson.length; i++) {
        result.innerHTML += objJson[i].adName + "<br>";
    }
    page_span.innerHTML = page + "/" + numPages();

    if (page == 1) {
        btn_prev.style.visibility = "hidden";
    } else {
        btn_prev.style.visibility = "visible";
    }

    if (page == numPages()) {
        btn_next.style.visibility = "hidden";
    } else {
        btn_next.style.visibility = "visible";
    }
}

function numPages()
{
    return Math.ceil(objJson.length / records_per_page);
}

window.onload = function() {
    changePage(1);
};




      function filterByPrice(){
      let resultf=document.getElementById("filter").value;
      //console.log("aca"+ resultf) 
      cont=1;
      let url="'http://localhost:8080/filtrarlugar/ "
      let resulturl=url+resultf+"'"
      console.log(resulturl)
      fetch('http://localhost:8080/filtrarlugar/'+resultf )
      .then(response => response.json())
      .then(json => {

        console.log("acá va el dato"+json);
        cantdatos.innerHTML=""
        cantdatos.innerHTML="Lugares encontrados : " + json.length;
        result.innerHTML=""
        for(data of json){
         console.log(data)
      
          let nombrelugar=data.nombre_l; 
          let locationplace=data.ubicacion;
          let descripcionlugar=data.descripcion;
          let preciolugar=data.precio;
          let imglugar=data.img;

          let tarjeta="<div class='card'style='flex: 0 0 25%;text-align: center; height: 650px;'><div style='color:#65A4BE; background-color:white; font-size: 22px;' class='card-header'><b>$"+data.precio+"</b></div><img src='"+data.img+"' style=' max-height:290px; min-height:200px; height:30%;' class=card-img-top' alt='...'><div class='card-body'><h5 class='card-title'>"+data.nombre_l+"</h5><p class='card-text' style='text-align:justify;height: 65%;';> "+data.descripcion+"</p><a href='"+data.ubicacion+"' style='background-color:#0C8218; width:100%' class='btn btn-success'><b>VER MAPA</b></a></div></div>"

          


          
          //console.log(preciolugar);  
          objJson.push({ adName: tarjeta})
          //al inicio muestra los datos de la primera pagina
          if (cont<=records_per_page){
            let htmlContent=result.innerHTML        
            result.innerHTML=htmlContent+tarjeta
            btn_prev.style.visibility = "hidden";
          }
          cont++
         // insertAdjacentHTML().result=htmlContent+tarjeta

          
          /*let htmlcontent=result.innerHTML;
          result.innerHTML=htmlcontent+html*/
        }

      })}
      
     </script>

    
    
    </div>
  

    <script>
    verifyIsLogin();
    mostrartodo();
    </script>
    </div class="container-fluid">
    <div id="listingTable"></div>
    <a href="javascript:prevPage()" id="btn_prev">Prev</a>
    <a href="javascript:nextPage()" id="btn_next">Next</a>
    page: <span id="page"></span>

  </body>
</html>
      